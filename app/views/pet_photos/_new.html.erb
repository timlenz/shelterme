<div id="addPhoto" class="modal" data-backdrop="static" data-keyboard="false">
  <div class="modal-inner mediaModal">
    <div class="pageHeader">
      <div class="headerLogo">
        <%= image_tag("photoIcon.png", alt: "Add Photo") %>
      </div>
      <div class="headerInfo" style="width:450px;">
        <h1>Add a Photo of <%= @pet.name != '' ? @pet.name : @pet.animal_code %></h1><br>
				<p></p>
      </div>
	    <button class="close <%= @pet_photo.pet.pet_photos.size == 0 ? 'hide' : '' %>" data-dismiss="modal">&times;</button>
    </div>
    <div class="form">
	    <% if @pet.pet_photos.size > 0 %>
      <p>See <%= link_to "our tips", faq_path(anchor: "mediaTips"), style: "line-height:28px;font-size:12px;" %> on how to shoot great photos. 
      <% end %>
      Photos are limited to 5000x5000 and 20MB.</p>
      <div class="handhold" style="display:none;text-align:center;margin-bottom:20px;">
        This window will close once your upload is complete.
      </div>
			<%= simple_form_for @pet_photo do |f| %>
        <%= f.hidden_field :pet_id %>
        <%= f.hidden_field :user_id, value: current_user.id %>
			  <div class="row filedrop">
          <div>
            <span class="btn formBtn fileinput-button" style="width:145px;margin-left:20px;">
              <span>Choose Photo</span>
              <%= f.cl_image_upload(:image, tags: "#{@pet.slug}") %>
            </span>
            <p>Or drop file here</p>
            <%= f.button :submit, "Upload" %>
          </div>
        </div>
			<% end %>
			<div id="loadingPhoto" class="hide">
			  <div class="progress progress-striped active">
			  	<div class="bar" style="width: 0%"></div>
			  </div>
			</div>
    </div>
  </div>
</div>

<%= cloudinary_js_config %>
<script src="/assets/jquery.cloudinary.js?body=1" type="text/javascript"></script>
<script>
	//window.onbeforeunload = requirePhoto;
	function requirePhoto() 
	{
		return "Please add a photo to complete the pet's profile.";
	}
</script>
<script>	
	$(function(){
		
		// Show progress bar on upload start
		$('.cloudinary-fileupload').bind('fileuploadstart', function() {  
	  	$('#loadingPhoto, .handhold').show();
			$('button.close, .filedrop, .form p').hide();
			$('.cloudinary-fileupload').bind('fileuploadprogress', function(e, data){
				$('.mediaModal .headerInfo p').text(data.files[0].name);
				progress = parseInt(data.loaded / data.total * 100, 10);
				$('.progress .bar').css('width', progress + '%');
			});
		  return true;
		});

		// Show selected photo photo name
		$('.cloudinary-fileupload input[type=file]').change(function(){
			var new_label = escape($('input[type=file]').val()).replace('C%3A%5Cfakepath%5C','');
			$('.mediaModal .headerInfo p').text("new_label");
		});

		// Reset form if photo upload failure
		$('.cloudinary-fileupload').bind('fail', function() {
			alert("Upload failed.");
	  	$('#loadingPhoto, .handhold').hide();
			$('button.close, .filedrop').show();		
		});

		// Submit uploaded photo info to db when uploaded
		$('#addAvatar .cloudinary-fileupload').bind('fileuploaddone', function() {
			$('.filedrop input[type=submit]').click();
		  $.cookie("avatar", "true");
		});

		// Submit uploaded photo info to db when uploaded
		$('#addPhoto .cloudinary-fileupload').bind('fileuploaddone', function() {
			$('.filedrop input[type=submit]').click();
		});
	});
</script>